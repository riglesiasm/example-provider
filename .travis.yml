language: node_js
node_js:
  - 10
services:
  - docker
env:
  global:
    - PACT_BROKER_BASE_URL=https://riglesias-free-now.pact.dius.com.au/
    - PACT_BROKER_PUBLISH_VERIFICATION_RESULTS=true
    # Encrypted PACT_BROKER_TOKEN
    - secure: "lx9BLrvpiUhHOhqpdXeyYYq6taBh2BqdBtPbGsprnc8TAQNwhgcK261gpepdwF07OtKV9GwlalRVnarYesaSUSZTdVBbounH4myCIUtGf8Som0ClgdtCv+MrGo4hcm0Nnmjre1F7MRShi3ZjPw53s+rvOdY4lb/rYDOwEw4qMI0UfDyhVvJqTkvep/hDDBNo90T+9racnAijue5tPH0YeyYd0mUbN5ysQVYGIuBrfoKY92q9Tsi6VBK5N3aeL/RyZtPP2OCG1gEpMFKD4mn31qq0eRvrUTNhn1e0BXztfm1fLydIU1pNiE69Ic3mSz0IJv3F5vBPWtNBRbGf0bPm5tWN+q+wRofafK2Pd+9GOuIYgt7EQxCXFb52sS9vBi7p/jHEycC8gZbh0IK7ugf+6v5Ct6bUfCmzLZsSudRShyoENDyPM8m4zAjNEoxJ5EmwoEDbGP7flnLIVwLsYA5qngiZWKSF8IGF2tjUtkTGBUm7KSqwK7uJL45c9NHHFSy6aojbHBWAgiEYdksBAWZCHDfWp4/wrTX9aRe4MII5bNr7ChhNPB0RsM4pu3jrZeQ6g0akEtbOSK1vx67g+NtjqDcU7+kSo7xaBzqFDPC+e80bTw0tKlxc8opaBEt5vpdUIaWgHYY5xSmnmSuI7o8NKgFuq5IORRxPPMR6oNjxQM8="
before_script:
  - docker pull pactfoundation/pact-cli:latest
script:
  # When a webhook triggers a build, the PACT_URL will be set. In this case, just run the verification step.
  # Otherwise, run the normal build.
  # This is just to get around the fact that Travis CI only has one build definition per repository.
  # Normally you would define a separate job for the webhook triggered verification.
  - >
    if [ -n "${PACT_URL}" ]; then
      make ci_webhook
    else
      make ci
    fi
